---
title: "UF Waste Water Analysis"
author: "Dominick Lemas"
date: "7/20/2019"
output: 
  html_document:
    theme: spacelab 
    highlight: tango
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyr)
library(dplyr)
library(tidyverse)
library(ggplot2)

data.dir=paste0(Sys.getenv("USERPROFILE"),"\\Dropbox (UFL)\\02_Projects\\WASTE_WATER\\2018_KY_Sep18\\");data.dir

#Read Data
data.file.name="water.RData";data.file.name
data.file.path=paste0(data.dir,"",data.file.name);data.file.path
load(data.file.path)
water=water.df

# Matthew read data
# library(Hmisc)
# 
# water <- read_tsv("../data/water_cleaned.txt") %>% mutate_if(is.character, funs(na_if(., "")))


```


```{r , message=FALSE, warning=FALSE, echo=FALSE}
drugs=water %>%
  select(metabolite_name, barcode, time, run, location, value) %>%
  mutate(tmp=ifelse(value=="NA",0,1)) %>%
  group_by(metabolite_name) %>%
  tally(tmp) %>%
  rename(value=n) %>%
  filter(value >0) 

data=drugs %>% arrange(value)

```

# Overview
Wastewater samples were manually collected  during the football game between Florida and Kentucky on Saturday, September 8, 2018 (n = 80,651). Samples were collected near the Ben Hill Griffith Stadium at three discrete locations. Samples were collected at each site every 30 minutes beginning approximately an hour before kickoff until 30 minutes after the game.

### All Samples

Variables | Value
------------- | -------------
Total # of observations | `r sum(drugs$value)`
Total # of locations | `r length(unique(water$location))`
Total # of time points | `r length(unique(water$time))`
Total # of metabolites | `r length(unique(water$metabolite_name ))`
Total # of runs | `r length(unique(water$run))`



```{r message=FALSE, warning=FALSE, echo=FALSE, fig.cap = "Figure 1: Metabolites detected in all samples."}

# Reorder
data %>%
  mutate(percent=(value/66)*100) %>%
  arrange(value) %>%
  mutate(metabolite_name=factor(metabolite_name,metabolite_name)) %>%
  ggplot( aes(x=metabolite_name, y=percent)) +
    geom_segment( aes(x=metabolite_name, xend=metabolite_name, y=0, yend=percent), color="skyblue", size=1) +
    geom_point( color="blue", size=4, alpha=0.6) +
    theme_light() +
    coord_flip() +
    theme(
      panel.grid.major.y = element_blank(),
      panel.border = element_blank(),
      axis.ticks.y = element_blank()
    ) + xlab("") + ylab("Percentage of Samples")
```


```{r, echo=FALSE}

# observation by location

location=water %>%
  select(metabolite_name, barcode, time, run, location, value) %>%
  mutate(tmp=ifelse(value=="NA",0,1)) %>%
  group_by(location, run, time, metabolite_name) %>%
  tally(tmp) %>%
  rename(value=n)  %>% 
  ungroup() %>%
  group_by(location) %>%
  summarize(count=sum(value)) 

time=water %>%
  select(metabolite_name, barcode, time, run, location, value) %>%
  mutate(tmp=ifelse(value=="NA",0,1)) %>%
  group_by(location, run, time, metabolite_name) %>%
  tally(tmp) %>%
  rename(value=n)  %>% 
  ungroup() %>%
  group_by(location, time) %>%
  summarize(count=sum(value)) 

```

### Samples by location

Variables | Value
------------- | -------------
Location 1 # of obs  | `r location$count[1]`
Location 2 # of obs  | `r location$count[2]`
Location 3 # of obs  | `r location$count[3]`


```{r message=FALSE, warning=FALSE, echo=FALSE, fig.cap = "Figure 1: Metabolites detected in all samples."}

g <- ggplot(time, aes(x = time, y = count, color=location))+geom_bar(stat="identity")+theme_minimal()
g

```
