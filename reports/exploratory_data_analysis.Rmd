---
output: 
  html_document
title: "Exploratory data analysis"
author: "Matthew Shane Loop, PhD"
---

```{r, include = FALSE}
knitr::opts_chunk$set(message = FALSE, echo=FALSE)
library(Hmisc)
library(tidyverse)


water <- read_tsv("../data/water_cleaned.txt") %>% mutate_if(is.character, funs(na_if(., "")))

water
```

How many unique compounds are there under analysis? `r water %>% distinct(metabolite) %>% nrow()`

How many time points? `r water %>% distinct(time_pretty) %>% nrow()`

* 3 locations as the main unit of analysis (i)
* 11 time points where samples were taken (j)
* 2 extraction methods (k)
* 2 different MS machines (l)
* concentrations of 56 different metabolites in each run (m)

Here's a plot of the concentrations of each metabolite vs. time, across the 3 sites.

```{r}
water %>%
  ggplot(aes(x = time_pretty, y = value, color = metabolite, linetype = extraction, group = interaction(extraction, metabolite))) +
  geom_path() +
  facet_grid(machine ~location) +
  theme(
    legend.position = "bottom"
  )
```

Now, for each metabolite and run, how many missing values are there? And what proportion?
```{r}
water %>%
  group_by(metabolite, extraction, machine) %>%
  mutate(is_missing = if_else(is.na(value) == TRUE, 1, 0),
         number_of_observations = n()) %>%
  summarise(
    number_missing = sum(is_missing),
    proportion_missing = round(number_missing / n(), digits = 2)
  ) %>%
  arrange(proportion_missing) %>%
  knitr::kable(caption = "Number and proportion of missing values of concentration, across all locations and time points (n = 33). The number of missing values is not always consistent for a given metabolite between the two runs.") %>%
  kableExtra::kable_styling()
```


